# Правила для агентов работающих с tishcode

## О проекте

tishcode - это AI coding agent для автоматизации работы с GitHub issues и pull requests через GitHub App API.

**CLI команды:**
- `main.py fixissue <issue-url>` - создает PR для решения issue
- `main.py review <pr-url>` - делает ревью PR
- `main.py fixpr <pr-url>` - вносит исправления в существующий PR

**Webhook сервер:**
- `uvicorn server:app --reload --port 8000` - запуск сервера
- События:
  - `issues/opened` → fixissue (создаёт PR)
  - `pull_request_review/submitted` (changes_requested) → fixpr (с проверкой счётчика)
  - `check_suite/completed` → review
- Автоматический цикл: CI завершён → review → (changes_requested) → fixpr → CI → review → ... до approve или TC_MAX_RETRIES

## Структура проекта

Entry points:
- `main.py` - CLI для запуска команд
- `server.py` - FastAPI webhook сервер

Бизнес-логика в папке `src/`:
- `src/handlers.py` - обработчики команд (используются и CLI и сервером)
- `src/code_agent.py` - агенты для исправления issue и PR
- `src/review_agent.py` - агент для ревью PR
- `src/github_utils.py` - утилиты для работы с GitHub API
- `src/git_utils.py` - утилиты для работы с git репозиториями
- `src/db.py` - SQLite для отслеживания попыток фиксов (только сервер)
- `src/logger.py` - настройка логирования

## Правила кодирования

### uv

В проекте используется uv. С помощью uv add добавляем зависимости.
С помощью uv run запускаем.

### Type hints
Используй современный синтаксис type hints:
- `list[]`, `dict[]`, `tuple[]`, `set[]` вместо List, Dict, etc.
- `| None` вместо Optional
- Всегда указывай типы для параметров и возвращаемых значений

### Комментарии и документация
- Не пиши лишние комментарии в коде
- Только короткие докстринги к функциям на одну-две строчки
- Код должен быть самодокументируемым

### Логирование
- Используй базовое логирование через модуль `src/logger.py`
- **INFO** уровень - основные логи для пользователя (что происходит)
- **DEBUG** уровень - детальная информация для отладки
- Не спамь логами, только важная информация
- Уровень логирования настраивается через `LOG_LEVEL` в `.env`

## Конфигурация
Все секреты и настройки хранятся в `.env`. Смотри `.env.example` для примера.

### Переменные окружения
- Не используй значения по умолчанию для переменных окружения
- Если переменная не задана — выбрасывай ошибку при старте
- Это помогает сразу обнаружить проблемы с конфигурацией
